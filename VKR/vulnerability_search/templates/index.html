<!DOCTYPE html>
<html>
<head>
  <title>Button Example</title>
  <link rel="stylesheet" type="text/css" href="../static/styles.css">
</head>
<body>
  <div class="h1_title">
    <h1>Сканер уязвимостей</h1>
  </div>
  <input type="text" id="domain_name" placeholder="Введите доменное имя цели">
  <div class="container">
    <div class="column">
      <h5>Теги</h5>
      <label><input type="checkbox" id="cve"> CVE</label>
      <label><input type="checkbox" id="panel"> Panel</label>
      <label><input type="checkbox" id="wordpress"> Wordpress</label>
      <label><input type="checkbox" id="xss"> XSS</label>
      <label><input type="checkbox" id="exposure"> Exposure</label>
      <label><input type="checkbox" id="wp-plugin"> WP-Plugin</label>
      <label><input type="checkbox" id="osint"> OSINT</label>
      <label><input type="checkbox" id="tech"> Tech</label>
      <label><input type="checkbox" id="lfi"> LFI</label>
      <label><input type="checkbox" id="edb"> EDB</label>
    </div>
    <div class="column">
      <h5>Критичность</h5>
      <label><input type="checkbox" id="info"> Info</label>
      <label><input type="checkbox" id="high"> High</label>
      <label><input type="checkbox" id="medium"> Medium</label>
      <label><input type="checkbox" id="critical"> Critical</label>
      <label><input type="checkbox" id="low"> Low</label>
      <label><input type="checkbox" id="unknown"> Unknown</label>
    </div>
  </div>
  <div class="button-container">
    <button onclick="sendAll()">Set Parameters</button>
    <button onclick="startScan()">START</button>
    <button id="restart-server-btn">Restart Server</button>
  </div>
  <script>
    function sendAll() {
        sendDomainName();
        sendVulnerabilityTags();
        sendSeverity();
    }

    function sendDomainName() {
        var userInput = document.getElementById('domain_name').value;
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/create_domain_file', true);
        xhr.setRequestHeader('Content-Type', 'text/plain');
        xhr.send(userInput);
    }

    function sendVulnerabilityTags() {
        var checkboxes = ['cve', 'panel', 'wordpress', 'xss', 'exposure', 'wp-plugin', 'osint', 'tech', 'lfi', 'edb'];
        var tags_vulnerabilities = checkboxes.map(function(id) {
            return document.getElementById(id).checked ? id.charAt(0).toUpperCase() + id.slice(1) + ',' : '';
        }).join('');

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/create_tags_file', true);
        xhr.setRequestHeader('Content-Type', 'text/plain');
        xhr.send(tags_vulnerabilities.slice(0, -1)); // Удаляем последнюю запятую
    }

    function sendSeverity() {
        var severities = ['info', 'high', 'medium', 'critical', 'low', 'unknown'];
        var severity = severities.map(function(id) {
            return document.getElementById(id).checked ? id.charAt(0).toUpperCase() + id.slice(1) + ',' : '';
        }).join('');

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/create_severity_file', true);
        xhr.setRequestHeader('Content-Type', 'text/plain');
        xhr.send(severity.slice(0, -1));
    }

    function startScan() {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/start_scan_command', true);
        xhr.send(null);
    }

    document.getElementById("restart-server-btn").addEventListener("click", function() {
      fetch("/restart-server")
          .then(response => {
              if (!response.ok) {
                  throw new Error("Failed to restart server");
              }
              alert("Server restarted successfully");
          })
          .catch(error => {
              console.error("Error restarting server:", error);
              alert("Failed to restart server");
          });
    });
  </script>
</body>
</html>