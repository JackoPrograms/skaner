#!/bin/bash

### Часть скрипта 3:
# Ищем дерриетории и файлы на найденных поддоменах и ip-адресах. Переберает все поддомены и вызывает скрипт 2.1. для сканирования каждого поддомена.
# ----------------------------------------------------------------------------



# переменная для хранения имя дерриктории запуска_процесса_сканирования
name_folder=`cat name_folder.txt`

# Добавляем необходимые флаги для nuclei считывая их из файлов
severity_and_tags_flag="-tags "
severity_and_tags_flag+=`cat ./automated_scanning/tags_vulnerabilities.txt`
severity_and_tags_flag+=" -severity "
severity_and_tags_flag+=`cat ./automated_scanning/severity_vulnerabilities.txt`

# Зпускаем nuclei на найденых открытых портах для найденых ip-адресов
# nuclei -l ./$name_folder/inf/sort_nmap_out_kopiya_ip_ports.txt -o ./$name_folder/inf/nuclei_out.txt -c 10 $severity_and_tags_flag
nuclei -l ./$name_folder/inf/sort_nmap_out_kopiya_ip_ports.txt -o ./$name_folder/inf/nuclei_out.txt $severity_and_tags_flag

# nuclei -l domain_name.txt $severity_and_tags_flag

# Выводим информацию о завершении работы nuclei
echo "[ + ] nuclei закончил работу по поиску открытых портов"
cat ./$name_folder/inf/nuclei_out.txt


# Запускаем скрипт по записи данных в БД
python3 recording_vulnerability.py

wait